<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="x-ua-compatible" content="IE=Edge">
        <meta name="viewport" content="width=device-width, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <script type="text/javascript" src="js/enchant.js"></script>
        <script type="text/javascript" src="js/plugins/tl.enchant.js"></script>
        <style>body {margin: 0; padding: 0}</style>

        <script type="text/javascript">
            enchant();
            
            var lux = 29;
            
            window.ondevicelight = function (event) {
                lux = event.value;
            };
            
            navigator.requestWakeLock('screen')
            
            Mole = enchant.Class.create(Sprite, {
                initialize: function () {
                    var game = enchant.Game.instance;
                    Sprite.call(this, 60, 64);
                    
                    if (lux > 30){
                        this.image = game.assets["mole.png"];
                    }else{
                        this.image = game.assets["mole-dark.png"];
                    }
                    
                    this.addEventListener("touchstart", function () {
                        this.scene.removeChild(this);
                    });
                }
            });
            
            Enemy = enchant.Class.create(Mole, {
                initialize: function () {
                    Mole.call(this);
                    this.frame = [4, 5, 6, 7];
                    this.x = Math.random() * 410;
                    this.y = Math.random() * 260;
                    }
            });

            window.onload = function () {
                var game = new Game(480, 320);
                game.fps = 10;
                game.preload("mole.png", "farm.png", "mole-dark.png"); /* Precargar imagenes */

                game.onload = function () {
                    var map = new Map(480, 320);
                    map.image = game.assets["farm.png"];
                    map.loadData([[0]]); /*Cargar Mapa Posicion 0 por ser uno solo */
                    
                    game.rootScene.addChild(map);

                    game.rootScene.addEventListener('enterframe', function () {
                        if (game.frame % 20 == 0) {
                            this.addChild(new Enemy());
                        }
                    });

                };
                game.start();
            };
        </script>
    </head>
    <title>Mata Topos</title>
    <body>
    </body>
</html>